<!DOCTYPE html>
<html>
<head>
    <title>BIET Support Bot</title>
    <link rel="stylesheet" href="/static/style.css">
</head>

<body>

<div class="chat-container">
    <div class="chat-header">ðŸ¤– BIET Support Bot (JNTUH)</div>

    <div id="chatbox" class="chat-box"></div>

    <div class="chat-input">
        <input type="text" id="msg" placeholder="Type your message...">
        <button onclick="sendMsg()">Send</button>
    </div>
</div>

<script>
    // âœ… Send Message
    function sendMsg() {
        let message = document.getElementById("msg").value;
        if(message.trim() === "") return;

        fetch("/chat", {
            method: "POST",
            headers: {"Content-Type": "application/json"},
            body: JSON.stringify({message: message})
        });

        document.getElementById("msg").value = "";
    }

    // âœ… Load Chat Continuously
    function loadChat() {
        fetch("/get_chat")
        .then(res => res.json())
        .then(data => {
            let chatbox = document.getElementById("chatbox");
            chatbox.innerHTML = "";

            data.forEach(chat => {
                if(chat.sender === "User"){
                    chatbox.innerHTML += `
                        <div class="user-msg">
                            <span>${chat.message}</span>
                        </div>`;
                } 
                else {
                    // âœ… FIX: Convert \n into <br>
                    chatbox.innerHTML += `
                        <div class="bot-msg">
                            <span>${chat.sender}: ${chat.message.replace(/\n/g, "<br>")}</span>
                        </div>`;
                }
            });

            chatbox.scrollTop = chatbox.scrollHeight;
        });
    }

    setInterval(loadChat, 1000);
</script>

</body>
</html>
